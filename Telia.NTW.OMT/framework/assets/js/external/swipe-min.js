window.Swipe=function(element,options){var _this=this;element&&(this.container=element,this.element=this.container.children[0],this.browser={touch:function(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch}(),transitions:function(){var temp=document.createElement("swipe"),props=["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"];for(var i in props)if(void 0!==temp.style[props[i]])return!0;return!1}()},options=options||{},this.index=options.startSlide||0,this.speed=options.speed||300,this.callback=options.callback||function(){},this.transitionEnd=options.transitionEnd||function(){},this.delay=options.auto||0,this.cont=void 0!=options.continuous?!!options.continuous:!0,this.disableScroll=!!options.disableScroll,this.index=parseInt(this.index,10),this.setup(),this.begin(),this.element.addEventListener?(this.browser.touch?(this.element.addEventListener("touchstart",this,!1),this.element.addEventListener("touchmove",this,!1),this.element.addEventListener("touchend",this,!1)):(this.element.addEventListener("mouseover",this,!1),this.element.addEventListener("mouseleave",this,!1)),this.browser.transitions&&(this.element.addEventListener("webkitTransitionEnd",this,!1),this.element.addEventListener("msTransitionEnd",this,!1),this.element.addEventListener("oTransitionEnd",this,!1),this.element.addEventListener("transitionend",this,!1)),window.addEventListener("resize",this,!1)):window.onresize=function(){_this.setup()})},Swipe.prototype={setup:function(){if(this.slides=this.element.children,this.length=this.slides.length,this.cache=new Array(this.length),!(this.length<1)&&(this.width=this.container.getBoundingClientRect().width||this.container.offsetWidth,this.width)){var refArray=[[],[],[]];this.element.style.width=this.slides.length*this.width+"px";for(var index=this.length-1;index>-1;index--){var elem=this.slides[index];elem.style.width=this.width+"px",elem.setAttribute("data-index",index),this.browser.transitions&&(elem.style.left=index*-this.width+"px"),refArray[this.index>index?0:this.index<index?2:1].push(index)}this.browser.transitions&&(this._stack(refArray[0],-1),this._stack(refArray[1],0),this._stack(refArray[2],1)),this.container.style.visibility="visible"}},kill:function(){this.delay=0,clearTimeout(this.interval);for(var slideArray=[],i=this.slides.length-1;i>=0;i--)this.slides[i].style.width="",slideArray.push(i);this._stack(slideArray,0);var elem=this.element;elem.className=elem.className.replace("swipe-active",""),this.element.removeEventListener?(this.browser.touch?(this.element.removeEventListener("touchstart",this,!1),this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1)):(this.element.removeEventListener("mouseover",this,!1),this.element.removeEventListener("mouseout",this,!1)),this.browser.transitions&&(this.element.removeEventListener("webkitTransitionEnd",this,!1),this.element.removeEventListener("msTransitionEnd",this,!1),this.element.removeEventListener("oTransitionEnd",this,!1),this.element.removeEventListener("transitionend",this,!1)),window.removeEventListener("resize",this.resize,!1)):window.onresize=null},getPos:function(){return this.index},prev:function(delay){clearTimeout(this.interval),this.delay=delay||0,this.index?this.slide(this.index-1,this.speed):this.cont&&this.slide(this.length-1,this.speed)},next:function(delay){clearTimeout(this.interval),this.delay=delay||0,this.index<this.length-1?this.slide(this.index+1,this.speed):this.cont&&this.slide(0,this.speed)},pause:function(){clearTimeout(this.interval)},begin:function(){var _this=this;this.interval=this.delay?setTimeout(function(){_this.next(_this.delay)},this.delay):0},handleEvent:function(e){switch(e.type){case"mouseover":this.pause();break;case"mouseleave":this.begin();break;case"touchstart":this.onTouchStart(e);break;case"touchmove":this.onTouchMove(e);break;case"touchend":this.onTouchEnd(e);break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"transitionend":this.onTransitionEnd(e);break;case"resize":this.setup()}},onTouchStart:function(e){var _this=this;_this.start={pageX:e.touches[0].pageX,pageY:e.touches[0].pageY,time:Number(new Date)},_this.isScrolling=void 0,_this.deltaX=0},onTouchMove:function(e){var _this=this;e.touches.length>1||e.scale&&1!==e.scale||(_this.deltaX=e.touches[0].pageX-_this.start.pageX,"undefined"==typeof _this.isScrolling&&(_this.isScrolling=!!(_this.isScrolling||Math.abs(_this.deltaX)<Math.abs(e.touches[0].pageY-_this.start.pageY))),_this.isScrolling?_this.disableScroll&&e.preventDefault():(e.preventDefault(),_this.delay=0,clearTimeout(_this.interval),_this.deltaX=_this.deltaX/(!_this.index&&_this.deltaX>0||_this.index==_this.length-1&&_this.deltaX<0?Math.abs(_this.deltaX)/_this.width+1:1),_this._move([_this.index-1,_this.index,_this.index+1],_this.deltaX)))},onTouchEnd:function(){var _this=this,isValidSlide=Number(new Date)-_this.start.time<250&&Math.abs(_this.deltaX)>20||Math.abs(_this.deltaX)>_this.width/2,isPastBounds=!_this.index&&_this.deltaX>0||_this.index==_this.length-1&&_this.deltaX<0,direction=_this.deltaX<0;_this.isScrolling||(isValidSlide&&!isPastBounds?(direction?(_this._stack([_this.index-1],-1),_this._slide([_this.index,_this.index+1],-_this.width,_this.speed),_this.index+=1):(_this._stack([_this.index+1],1),_this._slide([_this.index-1,_this.index],_this.width,_this.speed),_this.index+=-1),_this.callback(_this.index,_this.slides[_this.index])):_this._slide([_this.index-1,_this.index,_this.index+1],0,_this.speed))},onTransitionEnd:function(e){this._getElemIndex(e.target)==this.index&&(this.delay&&this.begin(),this.transitionEnd(this.index,this.slides[this.index]))},slide:function(to){clearTimeout(this.interval);var from=this.index;if(from!=to){if(this.browser.transitions){for(var toStack=Math.abs(from-to)-1,direction=Math.abs(from-to)/(from-to),inBetween=[];toStack--;)inBetween.push((to>from?to:from)-toStack-1);this._stack(inBetween,direction),this._slide([from,to],this.width*direction,this.speed)}else this._animate(from*-this.width,to*-this.width,this.speed);this.index=to,this.callback(this.index,this.slides[this.index])}},_slide:function(nums,dist,speed){clearTimeout(this.interval);for(var _slides=this.slides,l=nums.length;l--;)this._translate(_slides[nums[l]],dist+this.cache[nums[l]],speed?speed:0),this.cache[nums[l]]+=dist},_stack:function(nums,pos){for(var _slides=this.slides,l=nums.length,dist=this.width*pos;l--;)this._translate(_slides[nums[l]],dist,0),this.cache[nums[l]]=dist},_move:function(nums,dist){for(var _slides=this.slides,l=nums.length;l--;)this._translate(_slides[nums[l]],dist+this.cache[nums[l]],0)},_translate:function(elem,xval,speed){if(elem){var style=elem.style;style.webkitTransitionDuration=style.MozTransitionDuration=style.msTransitionDuration=style.OTransitionDuration=style.transitionDuration=speed+"ms",style.webkitTransform="translate("+xval+"px , 0)",style.msTransform=style.MozTransform=style.OTransform="translateX("+xval+"px)"}},_animate:function(from,to,speed){var elem=this.element;if(!speed)return elem.style.left=to+"px",void 0;var _this=this,start=new Date,timer=setInterval(function(){var timeElap=new Date-start;return timeElap>speed?(elem.style.left=to+"px",_this._getElemIndex(elem)==_this.index&&(_this.delay&&_this.begin(),_this.transitionEnd(_this.index,_this.slides[_this.index])),clearInterval(timer),void 0):(elem.style.left=(to-from)*(Math.floor(timeElap/speed*100)/100)+from+"px",void 0)},4)},_getElemIndex:function(elem){return parseInt(elem.getAttribute("data-index"),10)}},(window.jQuery||window.Zepto)&&!function($){$.fn.Swipe=function(params){return this.each(function(){var _this=$(this);_this.data("Swipe",new Swipe(_this[0],params))})}}(window.jQuery||window.Zepto);